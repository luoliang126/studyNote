# d3.js使用

1. ##### d3介绍

   ```js
   当前d3版本：6.3.1
   为什么要强调写这篇文档时候的版本？
   因为d3的兼容性非常差（尤其是向下兼容！！！），这里提到的应该是v6版本，在网上看示例的时候，好多都是基于v3或者v4的，在v6上完全不能运行，心塞......
   但幸运的是，思维与实现方法确实相通的，可以慢慢摸索！
   ```
   
   
   
2. ##### 基本使用

   ```js
   1、引入d3
   cdn方式：<script src="https://d3js.org/d3.v5.min.js"></script>
   es6方式：npm install d3
   		import * as d3 from 'd3'
   
   2、选择器(类似jq) select、selectAll
   d3.select("#id")
   d3.select("body").style("background-color", "black"); // 设置body背景色
   
   链式调用
   d3.selectAll("p")
   .data([4, 8, 15, 16, 23, 42])
   .style("font-size", function(d) { return d + "px"; });
   
   3、添加节点和元素 append、text、html
   <div class = "myclass">
   	Hello World!
   </div>
   d3.select("div.myclass").append("span");
   d3.select("div.myclass").append("span").text("from D3.js");
   d3.select("div.myclass").append("span").html("from D3.js");
   
   4、设置或更新样式。style
   d3.select("div.myclass").append("span").style('color','red');
   
   5、查看/添加/删除 class属性。classed
   d3.select(".myclass").classed("myanotherclass"); // 查看是否存在class---myanotherclass，有返回true，否则为false
   d3.select(".myclass").classed("myanotherclass", true); // 添加class
   d3.select(".myclass").classed("myanotherclass", false); //　删除class
   
   6、添加或更新所选元素的属性。attr
   const instance = d3.select('#id');
   instance.attr('name','luoliang');
   instance.attr('style','color:red'); // 样式也是属性，但不推荐这样操作，直接操作style更方便
   
   7、删除元素：remove、exit
   
   8、数据和图元绑定：datum\data\enter\exit
   <p id="p"></p>
   <ul id = "list">
       <li></li>
       <li></li>
   </ul>
   datum()方法用于为HTML文档中的单个元素设置值。
   d3.select("#p")
   	.datum(50)
       .text(function(d) { 
       	return "Used existing paragraph element and the data " + d; 
   	});
   data()为数组映射，这里虽然传了5条数据，但是界面只能渲染2条（从前往后），因为只有2个li
   d3.select("#list").selectAll("li")
      .data([10, 20, 30, 25, 15])      
      .text(function(d,i) { return d; }); // d是当前遍历的值，i是索引
   剩下的数据想渲染怎么办？enter()
   d3.select("#list").selectAll("li")
      .data([10, 20, 30, 25, 15])
      .text(function(d) { return "This is pre-existing element and the value is " + d; })
      .enter()
      .append("li")
      .text(function(d) { return "This is dynamically created element and the value is " + d; });
   exit()方法输出不再存在数据的图形元素集。
   
   9、过渡、动画：transition、duration、delay
   过渡效果：
   d3.select("#list").selectAll("li")
       .transition()
       .duration(3000)
       .delay(3000)
       .style("background-color",'red')
   定义过渡时长，这样方便传递参数做封装，注意transition放在动画前/后，都是可行的，delay必须跟在transition后面
   const t = d3.transition().duration(3000);
   d3.select("#list").selectAll("li")
   .style("background-color",'red')
   .transition(t)
   
   循环动画效果：定义一个函数，监听执行完后，再次执行，达到无限循环效果
   const li = d3.select("#list").selectAll("li")
   const runLi = () => {
       li
       .transition()
       .duration(1000)
       .delay(100)
       .ease(d3.easePolyInOut)
       .style("background-color",'red')
       .transition()
       .duration(1000)
       .delay(100)
       .ease(d3.easePolyInOut)
       .style("background-color",'green')
       .on('end',runLi)
   }
   runLi()
   
   10、事件的绑定
   <svg class="svg" id="svg"></svg>
   const svgEle = d3.select('#svg')
   const data = [[12,34],[24,12],[56,23]];
   const lineData = d3.line()(data);
   svgEle.append('path')
   .attr('d',lineData)
   .style('fill','none')
   .style('stroke','black')
   .style('stroke-width','10')
   .on('click',function(){
       alert(123); // 这里可以做一些操作
   })
   ```

   

3. ##### 选择器

   ```js
   1、此方法用于选择根元素.此函数也可用于测试选择或扩展选择d3js.
   d3.selection()
   
   2、此方法用于选择与指定选择器字符串匹配的第一个元素.
   d3.select(selector)
   
   3、此方法选择与指定选择器字符串匹配的所有元素.
   d3. selectAll(selector)
   
   4、此方法用于选择元素.它选择与指定选择器字符串匹配的后代元素.返回选择中的元素按此选择中的相应父节点分组.如果没有元素匹配当前元素的指定选择器，或者选择器为null，则当前索引处的组将为空.
   selection.selectAll(selector)
   var b = d3.selectAll("p").selectAll("b"); // 选择所有p标签下的b标签
   
   5、此方法用于过滤选择，返回包含的新选择只有指定过滤器为真的元素.
   selection.filter(filter)
   var even = d3.selectAll("tr").filter(":nth-child(odd) "); // 这里，过滤一系列表行只返回奇数
   
   6、此方法用于返回与指定的其他选择合并的新选择.
   selection.merge(other)
   var rect = svg.selectAll("rect").data(data); 
   rect.enter().append("rect").merge(rect);
   
   7、此方法用于分配指定的选择器.它返回一个返回true的函数.
   d3.matcher(选择器)
   var p = selection.filter(d3.matcher("p"));
   
   8、此方法用于分配指定的元素名称它返回一个函数，假设这是父元素，它会创建给定名称的元素.
   d3.creator(姓名)
   selection.append(d3.creator("p"));
   
   9、此方法用于为每个选定的元素调用指定的函数，由当前数据(d)，当前索引(i)和当前组(节点)传递的顺序，其中此作为当前DOM元素(nodes [i])
   selection.each(function)
   parent.each(function(p, j) {
      d3.select(this)
         .selectAll(".child")
         .text(function(d, i) { return "child " + d.name + " of " + p.name; });
   });
   
   10、它用于完全调用指定的函数一次
   selection.call(function [，arguments ...])
   
   function name(selection, first, last) {
      selection.attr("first-name", first).attr("last-name", last);
   }
   d3.selectAll("p").call(name，"Adam"，"David");
   
   11、D3 local允许您定义独立于数据的本地状态.
   d3.local()
   
   local.set(node，value)
   local.get(node)
   local.remove(node)
   ```

   

4. ##### 集合collection

   ```js
   集合只是一个将多个元素组合成一个单元的对象.它也被称为容器。
   集合API包含：对象、地图、集合、嵌套
   
   ```

   

5. ##### 数组

   ```js
   1、求数组最小值 d3.min(数组)
   var arr = [9,2,2,19,2]
   var res = d3.min(arr)
   console.log(res); //2
   
   2、求数组最大值 d3.max(数组)
   var arr = [9,2,2,19,2]
   var res = d3.max(arr)
   console.log(res); //19
   
   3、返回最小值和给定数组中的最大值（数组的区间）。 d3.extent(array)
   var arr = [9,2,2,19,2]
   var res = d3.extent(arr)
   console.log(res);  // [2,19]
   
   4、返回数组的总和，为空则为0. d3.sum(array)
   var arr = [9,2,2,19,2]
   var res = d3.sum(arr)
   console.log(res);  // 34
   
   5、返回给定数字数组的平均值。d3.mean(array)
   var arr = [9,2,2,19,2]
   var res = d3.mean(arr)
   console.log(res); // 6.8
   
   6、返回给定排序数字数组的p分位数，其中p是[0,1]范围内的数字 d3.quantile(array)
   注意：先将数组排序，再分位。分位只能在区间0--1之间
   var arr = [9,2,19,3,1]
   // 先排序 [1,2,3,9,19]
   var res1 = d3.quantile(arr,0) // 1 即开始位
   var res2 = d3.quantile(arr,0.5) // 3 即中间位
   var res3 = d3.quantile(arr,1) // 19 即末位
   
   7、返回给定数字数组的方差. d3.variance(array) 没明白具体意思！！！
   var arr = [9,2,19,3,1]
   var res = d3.variance(arr)
   console.log(res); // 56.2
   
   8、返回给定数组的标准偏差.如果数组的值少于两个，则返回undefined. d3.deviation(array) 没明白具体意思！！！
   var arr = [9,2,19,3,1]
   var res = d3.deviation(arr)
   console.log(res); // 7.496665925596525
   
   9、用于执行指定数组的线性扫描。它将最小元素的索引返回给指定的比较器。 d3.scan(array)
   var arr = [9,2,19,3,1]
   let res = d3.scan(arr, function(a, b) { return a - b; }); // 这里是最小值的索引
   console.log(res); // 4 
   
   var arr = [{ num:1 },{num:3}]
   let res = d3.scan(arr, function(a, b) { return b.num - a.num }); //这里算的是最大值的索引
   console.log(res); // 1
   
   10、合并数组，返回新数组 d3.merge([],[],......)
   var arr1 = [0,1];
   var arr = [2,3];
   let res = d3.merge([arr,arr1]);
   console.log(res); //  [2, 3, 0, 1]
   ```

   

6. ##### 路径path

   ```js
   path比line更加灵活使用！
   1、d3.path() : 此方法用于创建新路径.
   
   2、path.moveTo(x，y) : 此方法用于移动指定的x和y值.
   
   3、path.closePath() : 此方法用于关闭当前路径.
   
   4、lineTo(x，y)、line(lineData) : 此方法用于创建从当前点到定义的x，y值的线，也可以是数据填充方式
   <svg class="svg" id="svg"></svg>
   var data = [[0, 20], [50, 30], [100, 50], [200, 60], [300, 90]]; // 路径坐标点
   var lineData = d3.line()(data); // 获取line路径（返回一个字符串数据 M0,20L50,30L100,50L200,60L300,90），(M0,20)  (L50,30) 数据是这样拆分的，具体参考svg部分
   var svg = d3.select('#svg');
   svg.append('path').attr('d', lineData).style('fill','none').style('stroke','black'); //样式可以先修改再绘，也可以先绘再修改样式
   
   5、path.quadraticCurveTo(cpx，cpy，x，y ) : 此方法用于绘制从当前点到指定点的二次曲线.
   
   6、path.bezierCurveTo(cpx1，cpy1，cpx2，cpy2， x，y) : 此方法用于绘制从当前点到指定点的贝塞尔曲线.
   
   7、path.arcTo(x1，y1，x2，y2，radius) : 此方法用于从当前点到指定点(x1，y1)绘制圆弧，并结束指定点(x1，y1)和(x2，y2)之间的直线.
   
   8、path.arc(x，y，radius，startAngle，endAngle [，anticlockwise]) : 此方法用于将圆弧绘制到指定的中心(x，y)，半径，startAngle和endAngle.如果逆时针值为真，则弧沿逆时针方向绘制，否则沿顺时针方向绘制.
   
   9、path.rect(x ，y，w，h) : 该方法用于创建仅包含四个点(x，y)，(x + w，y)，(x + w，y + h)，(x，y + h)的新子路径.通过这些由直线连接的四个点将子路径标记为闭合.相当于context.rect并使用SVG的"lineto"命令.
   
   10、path.toString() : 根据SVG的路径数据规范返回此路径的字符串表示形式.
   ```

   

7. ##### 样式style

   ```js
   
   ```
   
   
   
8. ##### 缩放scale

   ```js
   d3.scaleLinear() : 构造一个连续的线性比例，我们可以将数据(域)地图输入到指定的输出范围.
   
   d3.scaleIdentity()  : 去;构造一个线性比例，其中输入数据与输出相同.
   
   d3.scaleTime() : 构造一个线性比例，其中输入数据在日期中，输出在数字中.
   
   d3.scaleLog() : 构造对数刻度.
   
   d3.scaleSqrt() : 构造平方根比例.
   
   d3.scalePow() : 构造一个指数尺度.
   
   d3.scaleSequential() : 构造一个顺序刻度，其中输出范围由插值函数确定.
   
   d3.scaleQuantize() : 构建具有离散输出范围的量化比例.
   
   d3.scaleQuantile() : 构造一个分位数刻度，其中输入样本数据映射到离散输出范围.
   
   d3.scaleThreshold() : 构造一个比例，其中任意输入数据映射到离散输出范围.
   
   d3.scaleBand() : 带尺度与序数尺度相似，但输出范围是连续和数字.
   
   d3.scalePoint() : 构建一个点量表.
   
   d3.scaleOrdinal() : 构造一个序数比例，其中输入数据包含字母并映射到离散数字输出范围.
   ```

   

9. ##### 坐标轴axis

10. ##### 拖动drag

11. ##### 形状（弧形）

12. ##### 颜色color

13. ##### 请求数据

14. ##### 计时器timer

    ```js
    
    ```

    

15. ##### 图表

    ```js
    1、Bar Chart
    
    Circle Chart
    
    Pie Chart
    
    Donut Chart
    
    Line Chart
    
    Bubble Chart, etc.
    ```

    

16. ##### 树状图

    ```js
    <div class="d3">
        <h3>树状图探究</h3>
    	<svg class="svg" id="chordDiagram"></svg>
    </div>
    treeData: {
        'name': '中国',
    	'children': [
            {
                'name': '浙江',
                'children':[
                    {'name': '杭州'},
                    {'name': '宁波'},
                    {'name': '温州'},
                    {'name': '绍兴'}
                ]
            },
            {
                'name': '广西',
                'children': [
                    {
                        'name': '桂林',
                        'children':[
                            {'name': '秀峰区'},
                            {'name': '叠彩区'},
                            {'name': '象山区'},
                            {'name': '七星区'}
                        ]
                    },
                    {'name': '南宁'},
                    {'name': '柳州'},
                    {'name': '防城港'}
                ]
            },
            {
                'name': '黑龙江',
                'children': [
                    {'name': '哈尔滨'},
                    {'name': '齐齐哈尔'},
                    {'name': '牡丹江'},
                    {'name': '大庆'}
                ]
            },
            {
                'name': '新疆',
                'children':[
                    {'name': '乌鲁木齐'},
                    {'name': '克拉玛依'},
                    {'name': '吐鲁番'},
                    {'name': '哈密'}
                ]
            }
    	]
    }
    treeDiagram () {
        const g = d3.select('#chordDiagram').append('g').attr('id','mainGroup')
        // 生成一个带有depth、height深度和高度的数组
        let res = d3.hierarchy(this.treeData)
        // 生成一个带有x、y坐标的数组
        res = d3.tree().size([400,400])(res);
        // 定义一个render函数
        const render = function(){
            // 绘制路径
            g.selectAll('path').data(res.links()).join('path')
                .attr('fill','none')
                .attr('stroke','black')
                .attr('d',d3.linkHorizontal().x(d => d.y).y(d => d.x))
            // 绘制圆点
            g.selectAll('circle').data(res.descendants()).join('circle')
                .attr('cx',d => d.y)
                .attr('cy',d => d.x)
                .attr('fill')
                .attr('stroke-width',3)
                .attr('r',6)
        }
        render();
    }
    ```

    

17. 虚位以待！！

    ```
    html,css   ,js
    html:
    <h1>   </h1>
    
    
    
    
    ```

    